#include <ModbusMaster.h>

#define DE_RE_PIN 2  // Pin kontrol untuk DE dan RE

void setup() {
  pinMode(DE_RE_PIN, OUTPUT);
  digitalWrite(DE_RE_PIN, HIGH); // Mode TX (aktif kirim)

  Serial.begin(115200);     // Debug serial monitor
  Serial1.begin(115200);    // Gunakan Serial1 untuk komunikasi RS485 (TX1 = pin 18)
}

void kirimPacket(const uint8_t* packet, size_t panjang, const char* namaPacket) {
  Serial.print(namaPacket);
  Serial.print("[] = { ");
  for (size_t i = 0; i < panjang; i++) {
    if (i % 16 == 0) Serial.println();
    Serial.print("0x");
    if (packet[i] < 0x10) Serial.print("0");
    Serial.print(packet[i], HEX);
    Serial.print(", ");
  }
  Serial.println("};\n");

  Serial1.write(packet, panjang);
  delay(50);  // Delay antar paket
}

void loop() {
  // Data lengkap fingerprint dalam 6 paket (selain packet1)
  //  uint8_t packet1[] = {
  //   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  //   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  //   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,0x00, 0x10,
  // };

  uint8_t packet2[] = {
    0x1A, 0xA5, 0x06, 0x00, 0x02, 0x03, 0x1D, 0x00, 0x01, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
  };
  
  uint8_t packet3[] = {
    0x2A, 0xA5, 0x06, 0x00, 0x02, 0x03, 0x1D, 0x01, 0x01, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
  };
  
  uint8_t packet4[] = {
    0x3A, 0xA5, 0x06, 0x00, 0x02, 0x03, 0x1D, 0x02, 0x01, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
  };
  
  uint8_t packet5[] = {
    0x4A, 0xA5, 0x06, 0x00, 0x02, 0x03, 0x1D, 0x03, 0x01, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
  };
  
  uint8_t packet6[] = {
    0x5A, 0xA5, 0x06, 0x00, 0x02, 0x03, 0x1D, 0x04, 0x01, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
  };
  
  uint8_t packet7[] = {
    0x6A, 0xA5, 0x06, 0x00, 0x02, 0x03, 0x1D, 0x05, 0x01, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20
  };

  // Kirim semua paket
  // kirimPacket(packet1, sizeof(packet1), "packet1");
  kirimPacket(packet2, sizeof(packet2), "packet2");
  kirimPacket(packet3, sizeof(packet3), "packet3");
  kirimPacket(packet4, sizeof(packet4), "packet4");
  kirimPacket(packet5, sizeof(packet5), "packet5");
  kirimPacket(packet6, sizeof(packet6), "packet6");
  kirimPacket(packet7, sizeof(packet7), "packet7");

  while (true); // Hentikan loop agar tidak terus mengulang
}